YUI.namespace("com.schoolspecialty.ebs.istore.cartActions").addToCart=function(itemParams,options,shopListObj){YUI().use("io","panel","json-parse","json-stringify",function(Y){var pub={waitPanel:"Not initialized"};pub.showWaitPanel=function(contHeader,contBody){this.waitPanel=new Y.Panel({srcNode:"addToCartWaitPanel",headerContent:contHeader,bodyContent:contBody,modal:true,constrain:true,centered:true,zIndex:10000,render:true,buttons:[],hideOn:[]});YUI.com.schoolspecialty.ebs.istore.alwaysCenter(pub.waitPanel);pub.waitPanel.show();};var parameters={formName:null,params:null,quickView:null,productCollection:null,errorMsgClass:null};if(options){Y.mix(parameters,options,[overwrite=true]);}pub.addErrorMessage=function(errorMessage){if(parameters.quickView){parameters.quickView.addError(errorMessage);}else{if(parameters.productCollection&&parameters.productCollection=="Y"){Y.one("#pcItemErrMsg_"+itemParams.itemId).setHTML(errorMessage);}else{if(Y.one("#skuErrorMessage")){Y.one("#skuErrorMessage").setHTML(errorMessage);}else{if(Y.one("#error_"+itemParams.itemId)){Y.one("#error_"+itemParams.itemId).setHTML(errorMessage);}else{if(Y.one("#shopListQuickViewErrMsg")){Y.one("#shopListQuickViewErrMsg").setHTML(errorMessage);}else{if(Y.one("#err_msg_"+itemParams.itemId)){Y.one("#err_msg_"+itemParams.itemId).setHTML(errorMessage);}else{alert(errorMessage);}}}}}}};pub.addErrorMessage("");if((parameters.productCollection&&parameters.productCollection=="Y")||(parameters.ideasResources&&paramters.ideasResources=="Y")){if(parameters.errorMsgClass){$("."+parameters.errorMsgClass).each(function(index,value){$(this).html("");});$("#addItemsError").html("");}}var NUMBER_PATTERN=new RegExp("^\\d+$");if(itemParams.itemQuantity==""||!itemParams.itemQuantity.match(NUMBER_PATTERN)||itemParams.itemQuantity<1){pub.addErrorMessage("Invalid Quantity");return;}var newForm=false;var addToCartForm=document.forms[parameters.formName];if(addToCartForm==null){newForm=true;addToCartForm=document.createElement("form");document.body.appendChild(addToCartForm);}pub.addHidden=function(name,value){var h=document.createElement("input");h.setAttribute("type","hidden");h.setAttribute("name",name);h.setAttribute("value",value);addToCartForm.appendChild(h);};pub.addHidden("itemId",itemParams.itemId);pub.addHidden("qty",itemParams.itemQuantity);pub.addHidden("itemNumber",itemParams.itemNumber);pub.addHidden("processingAction","addToCart");if(itemParams.pageType){pub.addHidden("pageType",itemParams.pageType);}if(parameters.params!=null&&parameters.params.length>0){var urlParams=parameters.params.split("&");for(var i=0;i<urlParams.length;i++){var tmp=urlParams[i].split("=");pub.addHidden(tmp[0],tmp[1]);}}pub.showWaitPanel("Processing, please wait...",'<div align="center" width="100%"><img src="/OA_HTML/xxssi/iStore/vic-animation3.gif"/></div>');addToCartForm.id=Y.guid();pub.addMask=function(){var mask=Y.one(".yui3-widget-mask");if(mask!=null){mask.setAttribute("style","position: fixed; width: 100%; height: 100%; top: 0px; left: 0px; z-index: 1000;");mask.removeAttribute("hidden");}};pub.removeMask=function(){var maskNode=document.getElementById("windowMask");if(maskNode!=null){maskNode.parentNode.removeChild(maskNode);}};Y.io("/OA_HTML/xxssi_ibeCCtdMenu.jsp",{method:"POST",form:addToCartForm,on:{success:function(id,o){if(newForm){document.body.removeChild(addToCartForm);}var response=Y.JSON.parse(o.responseText);if(response.errorMessage==null){YUI().use("cart-module",function(Y){YUI.com.schoolspecialty.ebs.istore.cartModule.refreshCart(o.responseText);if(response.items[0]!=null){itemParams.itemPrice=""+response.items[0].lineTotal;itemParams.itemQuantity=response.items[0].itemQuantity;}try{if(typeof fbq!=="undefined"){fbq("track","AddToCart",{content_name:itemParams.itemName,content_category:"School Specialty Marketplace",content_ids:[itemParams.itemNumber],content_type:"product",value:itemParams.itemPrice.replace("$",""),currency:"USD"});}}catch(e){}if(parameters.quickView){parameters.quickView.panelHide();if(response.items[0]!=null){parameters.quickView.updatePrice(response.items[0].unitNetPrice);}}if(itemParams.pageType&&itemParams.pageType=="searchResults"){var searchPriceHTML=Y.Node.create(response.searchResultsPriceHTML);var node=Y.one("#searchPriceHTML_"+itemParams.itemId);var parent=node.get("parentNode");parent.removeChild(node);parent.prepend(searchPriceHTML);}if(shopListObj){shopListObj.hideQuickView();if(response.items[0]!=null){shopListObj.updatePrice(response.items[0].unitNetPrice,null,shopListObj.productNameNodeObj);}}pub.waitPanel.hide();pub.removeMask();YUI.com.schoolspecialty.ebs.istore.cartModule.justAdded(itemParams);if(itemParams.qtyFieldId!=null){var qtyValue="1";if(parameters.productCollection&&parameters.productCollection=="Y"){qtyValue="0";}var qtyField=Y.one("#"+itemParams.qtyFieldId);qtyField.set("value",qtyValue);}});}else{pub.addErrorMessage(response.errorMessage);pub.waitPanel.hide();if(parameters.quickView){pub.addMask();}}},failure:function(id,result){if(newForm){document.body.removeChild(addToCartForm);}pub.waitPanel.hide();pub.addMask();pub.addErrorMessage("Error adding item to cart, please try again later or contact Customer Care");}}});});};